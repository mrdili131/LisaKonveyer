@page "/KonveyerPage/{loan_request_id}"
@rendermode InteractiveServer
@inject LisaKonveyer.Data.ApplicationDbContext DbContext
@using Microsoft.EntityFrameworkCore
@using LisaKonveyer.Models

  <nav>
    <button class="nav-btn @(CurrentTab=="kredit"?"active":"")" data-tab="kredit">Kredit shartlari</button>
    <button class="nav-btn @(CurrentTab=="klient"?"active":"")" data-tab="klient">Klient ma‘lumotlari</button>
    <button class="nav-btn @(CurrentTab=="yashash"?"active":"")" data-tab="yashash">Yashash joyi</button>
    <button class="nav-btn @(CurrentTab=="telefon"?"active":"")" data-tab="telefon">Telefon raqamlar</button>
    <button class="nav-btn @(CurrentTab=="karta"?"active":"")" data-tab="karta">Karta ma‘lumotlari</button>
    <button class="nav-btn @(CurrentTab=="tasdiq"?"active":"")" data-tab="tasdiq">Tasdiqlash</button>
    <button class="nav-btn @(CurrentTab=="yakun"?"active":"")" data-tab="yakun">Yakunlash</button>
  </nav>

<div class="body">
  <div class="main">
    <h1 style="padding: 20px;">Ariza @req.Filial</h1>
    <!-- -----------------------------------First Tab-----Kredit------------------------------------------ -->
    <div class='tab @(CurrentTab=="kredit"?"active":"")' id="kredit">
        <div class="first-tab">
          <div class="credit-data">
            <h1>Kredit shartlari</h1>
            <label for="">Summa</label>
            <input type="number" @bind="req.Amount" id="credit_amount" placeholder="10 000 000">
            <div style="display: flex;flex-direction: row;gap:5px;">
              <div style="display: flex;flex-direction: column;gap:5px;">
                <label for="date_start">Boshlanish sana</label>
                <input @bind="req.StartDate" type="date" id="date_start" name="date_start">
              </div>
              <div style="display: flex;flex-direction: column;gap:5px;">
                <label for="date_start">Tugash sana</label>
                <input @bind="req.EndDate" type="date" id="date_end" name="date_end">
              </div>
            </div>
            <label for="pay_day">To‘lov kuni</label>
            <input @bind="req.PayDay" type="number" name="pay_day" id="pay_day" placeholder="10">
            <label for="rate">Yillik foizi</label>
            <input @bind="req.InterestRate" type="number" name="rate" id="credit_rate" placeholder="49%">
            <label for="fine">Jarima foizi</label>
            <input type="number" value="1" name="fine" id="fine" placeholder="1%">
            <button class="in_btn" id="make_graphic">Grafik yaratish</button>
          </div>
          <div>
            <table>
              <thead>
                <tr>
                  <th>Oy</th>
                  <th>Sana</th>
                  <th>To‘lov</th>
                  <th>Asosiy qarz</th>
                  <th>Foizlar</th>
                  <th>Qarz qoldig‘i</th>
                  <th>stavka %</th>
                </tr>
              </thead>
              <tbody id="graphic">
                <!-- <tr>
                  <td>1<td>
                  <td>12.02.2025</td>
                  <td>5 000</td>
                  <td>1 000</td>
                  <td>4 000</td>
                  <td>10 000</td>
                  <td>49%</td>
                </tr> -->
              </tbody>
            </table>
          </div>
        </div>
      </div>


    <!-- -----------------------------------Second Tab-----------Klient ma‘lumotlari------------------------------------ -->

      <div class="tab @(CurrentTab=="klient"?"active":"")" id="klient">
          <div class="second-tab">
            <h1>Mijoz ma‘lumotlari</h1>
            <div class="second-tab-data">
              <div class="input-item">
                <label for="jshshir">Jshshir</label>
                <input type="text" id="jshshir" name="jshshir" placeholder="JSHSHIR">
              </div>
              <div class="input-item">
                <label for="first_name">Ism</label>
                <input type="text" id="first_name" name="first_name" placeholder="Ism">
              </div>
              <div class="input-item">
                <label for="last_name">Familiya</label>
                <input type="text" id="last_name" name="last_name" placeholder="Familiya">
              </div>
              <div class="input-item">
                <label for="middle_name">Otasining ismi</label>
                <input type="text" id="middle_name" name="middle_name" placeholder="Otasining ismi">
              </div>
              <div class="input-item">
                <label for="gender">Jinsi</label>
                <select name="gender" id="gender" class="form-select" style="font-size: 25px;">
                  <option value="1">Erkak</option>
                  <option value="2">Ayol</option>
                </select>
              </div>
              <div class="input-item">
                <label for="birth_date">Tug‘ilgan sana</label>
                <input type="date" id="birth_date" name="birth_date">
              </div>
              <div class="input-item">
                <label for="region">Shahar(tuman)</label>
                <input type="text" id="region" name="region" placeholder="Farg‘ona viloyati">
              </div>
              <div class="input-item">
                <label for="country">Davlat</label>
                <input type="text" id="country" name="country" placeholder="O‘zbekiston">
              </div>
              <div class="input-item">
                <label for="education">Ma‘lumoti</label>
                <select name="education" id="education" style="font-size: 25px;">
                  <option value="1">Oliy</option>
                  <option value="2">O‘rta</option>
                  <option value="3">O‘rta-maxsus</option>
                  <option value="4">Tuganlanmagan oliy</option>
                  <option value="5">Boshlang‘ich</option>
                </select>
              </div>
            </div>
            <h1>Shaxsni tasdiqlovchi hujjat ma'lumotlari</h1>
            <div class="second-tab-data">
              <div class="input-item">
                <label for="serial">Passport seriyasi</label>
                <input type="text" id="serial" name="serial" placeholder="AB">
              </div>
              <div class="input-item">
                <label for="serial_num">Seriya raqami</label>
                <input type="text" id="serial_num" name="serial_num" placeholder="1001200">
              </div>
              <div class="input-item">
                <label for="pass_got">Olingan sanasi</label>
                <input type="date" id="pass_got" name="pass_got">
              </div>
              <div class="input-item">
                <label for="pass_exp">Tugash sanasi</label>
                <input type="date" id="pass_exp" name="pass_exp">
              </div>
              <div class="input-item">
                <label for="got_place">Berilgan joyi</label>
                <input type="text" id="got_place" name="got_place" placeholder="IIV 27248">
              </div>
              <div class="input-item">
                <label for="country_passport">Davlat</label>
                <input type="text" id="country_passport" name="country_passport" placeholder="O‘zbekiston">
              </div>
              <div class="input-item">
                <label for="region_pass">Shahar(tuman)</label>
                <input type="text" id="region_pass" name="region_pass" placeholder="Farg‘ona viloyati">
              </div>
              </div>
          </div>
      </div>

    <!-- -----------------------------------Third Tab--------------------Yashash joyi--------------------------- -->

      <div class="tab @(CurrentTab=="yashash"?"active":"")" id="yashash">
            <div class="third-tab">
              <h1>Ro'yxatdan o'tish manzili ma'lumotlari</h1>
              <div class="second-tab-data">
                <div class="input-item">
                    <label for="base_country">Davlat</label>
                    <input type="text" id="base_country" name="base_country" placeholder="O‘zbekiston">
                </div>
                <div class="input-item">
                    <label for="viloyat">Viloyat</label>
                    <input type="text" id="base_viloyat" name="viloyat" placeholder="Farg‘ona viloyati">
                  </div>
                <div class="input-item">
                    <label for="shahar">Shahar(tuman)</label>
                    <input type="text" id="base_shahar" name="shahar" placeholder="Farg‘ona shahri">
                </div>
                <div class="input-item">
                    <label for="address">Manzil</label>
                    <input type="text" id="base_address" name="address" style="width: 350px;" placeholder="Birnima MFY Birnima ko‘chasi 01-uy">
                </div>
              </div>
              <button class="in_btn" onclick="same_address()">Pastga tushirish</button>
              <h1>Joriy manzil ma'lumotlari</h1>
              <div class="second-tab-data">
                <div class="input-item">
                    <label for="country_pass">Davlat</label>
                    <input type="text" id="country_pass" name="country_pass" placeholder="O‘zbekiston">
                </div>
                <div class="input-item">
                    <label for="viloyat">Viloyat</label>
                    <input type="text" id="pass_viloyat" name="viloyat" placeholder="Farg‘ona viloyati">
                  </div>
                <div class="input-item">
                    <label for="shahar">Shahar(tuman)</label>
                    <input type="text" id="shahar" name="shahar" placeholder="Farg‘ona shahri">
                </div>
                <div class="input-item">
                    <label for="address">Manzil</label>
                    <input type="text" id="address" name="address" style="width: 350px;" placeholder="Birnima MFY Birnima ko‘chasi 01-uy">
                </div>
              </div>
            </div>
      </div>


    <!-- -----------------------------------Fourth Tab--------------------Telefon raqam--------------------------- -->

    <div class="tab @(CurrentTab=="telefon"?"active":"")" id="telefon">
          <div class="forth-tab">
            <div class="second-tab-data">
              <div class="input-item">
                  <label for="num">Telefon raqam</label>
                  <input type="text" id="num" name="num" style="width: 350px;" placeholder="94 139 07 72">
              </div>
              <div class="input-item">
                  <label for="num_comment">Izoh</label>
                  <input type="text" id="num_comment" name="num_comment" style="width: 350px;" placeholder="Birnimajon">
              </div>
              <button class="in_btn">Saqlash</button>
            </div>
            <div class="second-tab-data">
              <h1>94 139 07 72</h1>
              <h1>Birnimajon</h1>
              <button class="in_btn">O‘chirish</button>
            </div>
            <div class="second-tab-data">
              <h1>94 139 07 72</h1>
              <h1>Birnimajon</h1>
              <button class="in_btn">O‘chirish</button>
            </div>
            <div class="second-tab-data">
              <h1>94 139 07 72</h1>
              <h1>Birnimajon</h1>
              <button class="in_btn">O‘chirish</button>
            </div>
          </div>
    </div>


    <!-- -----------------------------------Fiveth Tab--------------------Karta ma‘lumotlari--------------------------- --> 

    <div class="tab @(CurrentTab=="karta"?"active":"")" id="karta">
          <div class="fiveth-tab">
            <div class="second-tab-data">
              <div class="input-item">
                  <label for="card">Kartani kiriting</label>
                  <input type="text" id="card" name="card" style="width: 350px;" placeholder="8600 0000 0000 0000">
              </div>
              <div class="input-item">
                  <label for="valid">Karta muddati</label>
                  <input type="text" id="valid" name="valid" style="width: 350px;" placeholder="12/27">
              </div>
              <button class="in_btn">Saqlash</button>
            </div>
          </div>
    </div>




    <!-- -----------------------------------Sixth Tab--------------------Tasdiqlash--------------------------- -->

    <div class="tab @(CurrentTab=="tasdiq"?"active":"")" id="tasdiq">
              <div class="sixth-tab">
                <h1>Ma'lumotlarni tasdiqlash</h1>
                <div class="main-sixth-tab">
                  <div style="display: flex;flex-direction: row;justify-content: space-between;gap:20px;">


                      <div class="sixth-tab-data">
                        <div class="row-data-view">
                          <p>FIO:</p>
                          <h2>Polonchiyev Polonchi Pistonchiyevich</h2>
                        </div>
                        <div class="row-data-view">
                          <p>JSHSHIR:</p>
                          <h2>8542465464443254242</h2>
                        </div>
                        <div class="row-data-view">
                          <p>TUG‘ILGAN SANA:</p>
                          <h2>@(req.EndDate?.ToString("dd-MM-yyyy")??"null")</h2>
                        </div>
                        <div class="row-data-view">
                          <p>TELEFON:</p>
                          <h2>94 139 07 72</h2>
                        </div>
                        <div class="row-data-view">
                          <p>KREDIT MAXSULOTI:</p>
                          <h2>@(req.Application?.Name ?? "null")</h2>
                        </div>
                        <div class="row-data-view">
                          <p>KREDIT SUMMASI:</p>
                          <h2>@(req.Amount?.ToString("N0") ?? "null")</h2>
                        </div>
                        <div class="row-data-view">
                          <p>KREDIT MUDDATI:</p>
                          <h2 id="credit_length">A lot</h2>
                        </div>
                        <div class="row-data-view">
                          <p>KREDIT FOIZ STAVKASI:</p>
                          <h2>@req.InterestRate%</h2>
                        </div>
                      </div>

                    <div class="sixth-tab-data">
                        <div class="row-data-view">
                          <p>Guvohnoma seriyasi va nomeri:</p>
                          <h2>AB 1529833</h2>
                        </div>
                        <div class="row-data-view">
                          <p>Guvohnoma turi:</p>
                          <h2>Биометрический паспорт гражданина Респ.Узбекистан</h2>
                        </div>
                        <div class="row-data-view">
                          <p>Berilgan sana:</p>c
                          <h2>08.10.2015</h2>
                        </div>
                        <div class="row-data-view">
                          <p>Tugash muddati:</p>
                          <h2>07.10.2025</h2>
                        </div>
                        <div class="row-data-view">
                          <p>Fuqarolik:</p>
                          <h2>Узбекистан</h2>
                        </div>
                        <div class="row-data-view">
                          <p>Berilgan:</p>
                          <h2>Toshkent viloyati Yuqorichirchiq tumani IIB</h2>
                        </div>
                        <div class="row-data-view">
                          <p>Ro'yxatdan o'tgan joyi:</p>
                          <h2>Узбекистан | ЮКОРИЧИРЧИК ТУМАНИ | ТОШКЕНТ ВИЛОЯТИ | "Fayzobod" MFY Tinchlik ko‘chasi 12-uy</h2>
                        </div>
                        <div class="row-data-view">
                          <p>Yashash joyi:</p>
                          <h2>Узбекистан | ЮКОРИЧИРЧИК ТУМАНИ | ТОШКЕНТ ВИЛОЯТИ | "Fayzobod" MFY Tinchlik ko‘chasi 12-uy</h2>
                        </div>
                      </div>
                  </div>
                </div>
              </div>
    </div>





    <!-- -----------------------------------Seventh Tab--------------------Tugatish--------------------------- -->


    <div class="tab @(CurrentTab=="yakun"?"active":"")" id="yakun">
          <div class="fiveth-tab">
            <div class="second-tab-data">
              <h1 style="color: white;">KREDITLASHNI YAKUNLASH</h1>
              <button class="in_btn">YAKUNLASH</button>
            </div>
          </div>
    </div>
  



  </div>



  <div class="footer">
    <button @onclick="OnPrevTab" id="prev-btn" class="bt-nav-btn">Orqaga</button>
    <a style="text-decoration: none;" href="index.html" class="bt-nav-btn">Berkitish</a>
    <button class="bt-nav-btn">Bekor qilish</button>
    <button @onclick="OnNextTab" id="next-btn" class="bt-nav-btn">Tasqidlash</button>
  </div>

  <div class="alert-view">
    <h1 class="alert-text">Saqlandi !</h1>
  </div>

</div>

@code{
  [Parameter]
  public string loan_request_id {get;set;}
  public int Id;

    List<string> Tabs = new List<string>{"kredit","klient","yashash","telefon","karta","tasdiq","yakun"};
    string CurrentTab = "kredit";
    LoanRequest req = new LoanRequest();

    protected override async Task OnInitializedAsync(){
      Id = int.Parse(loan_request_id);
      req = await DbContext.LoanRequests
        .Include(r => r.Application)
        .Include(r => r.User)
        .Include(r => r.Filial)
        .FirstOrDefaultAsync(i=>i.Id==Id);
    }

    public void OnNextTab(){
        var current = Tabs.IndexOf(CurrentTab);
        if (Tabs.Count - 1 > current){
            CurrentTab = Tabs[current+1];
            SaveRequest();
        }
        SaveRequest();
    }

    public void OnPrevTab(){
        var current = Tabs.IndexOf(CurrentTab);
        if (current > 0){
            CurrentTab = Tabs[current-1];
        }
    }

    public async Task SaveRequest(){
      DbContext.LoanRequests.Update(req);
      await DbContext.SaveChangesAsync();
    }
}


  <script>
    function numify(n){
      return Math.round(Number(n)).toLocaleString('en',{style:'decimal',useGrouping:true}).replace(/,/g,' ')
    }

</script>